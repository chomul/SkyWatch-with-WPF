<Window x:Class="SkyWatch.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:vm="clr-namespace:SkyWatch.ViewModels"
        xmlns:views="clr-namespace:SkyWatch.Views"
        xmlns:converters="clr-namespace:SkyWatch.Converters"
        mc:Ignorable="d"
        Title="SkyWatch"
        Height="900" Width="1400"
        MinHeight="600" MinWidth="900"
        WindowStartupLocation="CenterScreen"
        WindowStyle="None"
        AllowsTransparency="True"
        Background="Transparent"
        ResizeMode="CanResizeWithGrip">

    <Window.DataContext>
        <vm:MainViewModel/>
    </Window.DataContext>

    <!-- ViewModel → View 매핑 -->
    <Window.Resources>
        <converters:WeatherIconConverter x:Key="WeatherIconConverter"/>
        <DataTemplate DataType="{x:Type vm:HomeViewModel}">
            <views:HomeView/>
        </DataTemplate>
        <DataTemplate DataType="{x:Type vm:SearchViewModel}">
            <views:SearchView/>
        </DataTemplate>
        <DataTemplate DataType="{x:Type vm:FavoritesViewModel}">
            <views:FavoritesView/>
        </DataTemplate>
        <DataTemplate DataType="{x:Type vm:SettingsViewModel}">
            <views:SettingsView/>
        </DataTemplate>
    </Window.Resources>

    <!-- ── 앱 외곽 ── -->
    <Border Background="{DynamicResource BgMidBrush}"
            CornerRadius="16"
            BorderBrush="#12FFFFFF"
            BorderThickness="1">
        <Border.Effect>
            <DropShadowEffect BlurRadius="30" ShadowDepth="0" Opacity="0.5" Color="#000000"/>
        </Border.Effect>

        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="44"/>   <!-- 타이틀바 -->
                <RowDefinition Height="*"/>    <!-- 본문 -->
            </Grid.RowDefinitions>

            <!-- ═══════════════════════════════════════ -->
            <!-- 타이틀바 (커스텀)                        -->
            <!-- ═══════════════════════════════════════ -->
            <Border Grid.Row="0"
                    Background="{DynamicResource TitleBarBgBrush}"
                    BorderBrush="{DynamicResource SubtleBorderBrush}"
                    BorderThickness="0,0,0,1"
                    CornerRadius="16,16,0,0"
                    MouseLeftButtonDown="TitleBar_MouseLeftButtonDown">
                <Grid Margin="16,0">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <!-- 왼쪽: 앱 아이콘 + 이름 -->
                    <StackPanel Grid.Column="0" Orientation="Horizontal"
                                VerticalAlignment="Center">
                        <!-- 앱 아이콘 -->
                        <Border Width="24" Height="24" CornerRadius="6" Margin="0,0,10,0">
                            <Border.Background>
                                <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                    <GradientStop Color="#4FA3FF" Offset="0"/>
                                    <GradientStop Color="#00E5FF" Offset="1"/>
                                </LinearGradientBrush>
                            </Border.Background>
                            <TextBlock Text="🌤" FontSize="13"
                                       HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <TextBlock Text="SkyWatch"
                                   FontSize="13" FontWeight="Medium"
                                   Foreground="{DynamicResource TextSecondaryBrush}"
                                   VerticalAlignment="Center"/>
                    </StackPanel>

                    <!-- 오른쪽: 창 컨트롤 버튼 -->
                    <StackPanel Grid.Column="2" Orientation="Horizontal"
                                VerticalAlignment="Center" Margin="0,0,4,0">
                        <Button Content="─" Style="{x:Null}"
                                Width="32" Height="28" FontSize="10"
                                Background="Transparent" Foreground="{DynamicResource TextMutedBrush}"
                                BorderThickness="0" Cursor="Hand"
                                Click="MinimizeButton_Click"/>
                        <Button Content="□" Style="{x:Null}"
                                Width="32" Height="28" FontSize="12"
                                Background="Transparent" Foreground="{DynamicResource TextMutedBrush}"
                                BorderThickness="0" Cursor="Hand"
                                Click="MaximizeButton_Click"/>
                        <Button Content="✕" Style="{x:Null}"
                                Width="32" Height="28" FontSize="12"
                                Background="Transparent" Foreground="{DynamicResource TextMutedBrush}"
                                BorderThickness="0" Cursor="Hand"
                                Click="CloseButton_Click"/>
                    </StackPanel>
                </Grid>
            </Border>

            <!-- ═══════════════════════════════════════ -->
            <!-- 본문: 사이드바 + 콘텐츠                   -->
            <!-- ═══════════════════════════════════════ -->
            <Grid Grid.Row="1">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="68"/>   <!-- 사이드바 -->
                    <ColumnDefinition Width="*"/>    <!-- 메인 콘텐츠 -->
                    <ColumnDefinition Width="240"/>  <!-- 즐겨찾기 패널 -->
                </Grid.ColumnDefinitions>

                <!-- ── 사이드바 ── -->
                <Border Grid.Column="0"
                        Background="{DynamicResource SidebarBgBrush}"
                        BorderBrush="{DynamicResource SubtleBorderBrush}"
                        BorderThickness="0,0,1,0">
                    <DockPanel Margin="0,20,0,20">
                        <!-- 하단 설정 버튼 -->
                        <RadioButton DockPanel.Dock="Bottom"
                                     Style="{DynamicResource NavButtonStyle}"
                                     Content="⚙️"
                                     GroupName="Nav"
                                     ToolTip="설정"
                                     Command="{Binding NavigateToCommand}"
                                     CommandParameter="Settings"
                                     IsChecked="{Binding SelectedNavIndex, Converter={x:Null}, Mode=OneWay}"
                                     Margin="0,0,0,0"/>

                        <!-- 상단 네비게이션 -->
                        <StackPanel VerticalAlignment="Top"
                                    HorizontalAlignment="Center">
                            <RadioButton Style="{DynamicResource NavButtonStyle}"
                                         Content="🏠"
                                         GroupName="Nav"
                                         ToolTip="홈"
                                         IsChecked="True"
                                         Command="{Binding NavigateToCommand}"
                                         CommandParameter="Home"/>
                            <RadioButton Style="{DynamicResource NavButtonStyle}"
                                         Content="🔍"
                                         GroupName="Nav"
                                         ToolTip="검색"
                                         Command="{Binding NavigateToCommand}"
                                         CommandParameter="Search"/>
                            <RadioButton Style="{DynamicResource NavButtonStyle}"
                                         Content="⭐"
                                         GroupName="Nav"
                                         ToolTip="즐겨찾기"
                                         Command="{Binding NavigateToCommand}"
                                         CommandParameter="Favorites"/>
                        </StackPanel>
                    </DockPanel>
                </Border>

                <!-- ── 메인 콘텐츠 영역 ── -->
                <ContentControl Grid.Column="1"
                                Content="{Binding CurrentView}"
                                Margin="0"/>

                <!-- ══════════════════════════════════════ -->
                <!-- 즐겨찾기 패널 (오른쪽 사이드)            -->
                <!-- ══════════════════════════════════════ -->
                <Border Grid.Column="2"
                        Background="#99050D1A"
                        BorderBrush="{DynamicResource SubtleBorderBrush}"
                        BorderThickness="1,0,0,0">
                    <DockPanel Margin="16,24,16,16">
                        <!-- ── 하단: 일출/일몰 카드 ── -->
                        <Border DockPanel.Dock="Bottom"
                                Background="#08FFFFFF"
                                BorderBrush="#0FFFFFFF" BorderThickness="1"
                                CornerRadius="14" Padding="14" Margin="0,12,0,0">
                            <StackPanel>
                                <TextBlock Text="☀️ 일출 · 일몰" FontSize="10" FontWeight="SemiBold"
                                           Foreground="{DynamicResource TextMutedBrush}"
                                           Margin="0,0,0,10"/>
                                <!-- 일출/일몰 시간 -->
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <!-- 일출 -->
                                    <StackPanel Grid.Column="0" HorizontalAlignment="Center">
                                        <TextBlock Text="🌅" FontSize="18" HorizontalAlignment="Center"/>
                                        <TextBlock Text="{Binding SunriseTime}" FontSize="13" FontWeight="SemiBold"
                                                   Foreground="{DynamicResource TextPrimaryBrush}"
                                                   HorizontalAlignment="Center" Margin="0,2,0,0"/>
                                        <TextBlock Text="일출" FontSize="10"
                                                   Foreground="{DynamicResource TextMutedBrush}"
                                                   HorizontalAlignment="Center" Margin="0,2,0,0"/>
                                    </StackPanel>
                                    <!-- 구분선 -->
                                    <Border Grid.Column="1" Width="1" Height="36"
                                            Background="#12FFFFFF" Margin="8,0"/>
                                    <!-- 일몰 -->
                                    <StackPanel Grid.Column="2" HorizontalAlignment="Center">
                                        <TextBlock Text="🌇" FontSize="18" HorizontalAlignment="Center"/>
                                        <TextBlock Text="{Binding SunsetTime}" FontSize="13" FontWeight="SemiBold"
                                                   Foreground="{DynamicResource TextPrimaryBrush}"
                                                   HorizontalAlignment="Center" Margin="0,2,0,0"/>
                                        <TextBlock Text="일몰" FontSize="10"
                                                   Foreground="{DynamicResource TextMutedBrush}"
                                                   HorizontalAlignment="Center" Margin="0,2,0,0"/>
                                    </StackPanel>
                                </Grid>
                                <!-- 낮 시간 바 -->
                                <Border Height="4" Background="#0FFFFFFF" CornerRadius="2" Margin="0,10,0,0">
                                    <Border CornerRadius="2" HorizontalAlignment="Left" Width="125">
                                        <Border.Background>
                                            <LinearGradientBrush StartPoint="0,0.5" EndPoint="1,0.5">
                                                <GradientStop Color="#FF9500" Offset="0"/>
                                                <GradientStop Color="#FFD166" Offset="1"/>
                                            </LinearGradientBrush>
                                        </Border.Background>
                                    </Border>
                                </Border>
                                <TextBlock Text="{Binding DaylightDuration}" FontSize="10"
                                           Foreground="{DynamicResource TextMutedBrush}"
                                           Margin="0,4,0,0"/>
                            </StackPanel>
                        </Border>

                        <!-- ── 상단: 즐겨찾기 헤더 + 도시 리스트 ── -->
                        <StackPanel>
                            <!-- 헤더 -->
                            <TextBlock Text="즐겨찾기" FontSize="11" FontWeight="SemiBold"
                                       Foreground="{DynamicResource TextMutedBrush}"
                                       Margin="0,0,0,12"/>
                            <Border Height="1" Background="#0AFFFFFF" Margin="0,0,0,12"/>

                            <!-- 도시 리스트 -->
                            <ItemsControl ItemsSource="{Binding FavoriteCities}">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Button Command="{Binding DataContext.SelectFavoriteCityCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                                CommandParameter="{Binding}"
                                                Cursor="Hand"
                                                Margin="0,0,0,8"
                                                Background="Transparent" BorderThickness="0" Padding="0">
                                            <Button.Template>
                                                <ControlTemplate TargetType="Button">
                                                    <Border x:Name="cityBorder"
                                                            Background="#08FFFFFF"
                                                            BorderBrush="#0DFFFFFF" BorderThickness="1"
                                                            CornerRadius="12" Padding="10,10">
                                                        <ContentPresenter/>
                                                    </Border>
                                                    <ControlTemplate.Triggers>
                                                        <Trigger Property="IsMouseOver" Value="True">
                                                            <Setter TargetName="cityBorder" Property="Background" Value="#12FFFFFF"/>
                                                        </Trigger>
                                                        <DataTrigger Binding="{Binding IsActive}" Value="True">
                                                            <Setter TargetName="cityBorder" Property="Background" Value="#1A4FA3FF"/>
                                                            <Setter TargetName="cityBorder" Property="BorderBrush" Value="#404FA3FF"/>
                                                        </DataTrigger>
                                                    </ControlTemplate.Triggers>
                                                </ControlTemplate>
                                            </Button.Template>
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="28"/>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                </Grid.ColumnDefinitions>
                                                <!-- 국기 -->
                                                <TextBlock Grid.Column="0" Text="{Binding FlagEmoji}"
                                                           FontSize="20" VerticalAlignment="Center" Foreground="{DynamicResource TextPrimaryBrush}"/>
                                                <!-- 도시 정보 -->
                                                <StackPanel Grid.Column="1" VerticalAlignment="Center" Margin="6,0,0,0">
                                                    <TextBlock Text="{Binding CityName}" FontSize="12" FontWeight="SemiBold"
                                                               Foreground="{DynamicResource TextPrimaryBrush}"/>
                                                    <StackPanel Orientation="Horizontal" Margin="0,2,0,0">
                                                        <TextBlock Text="{Binding Temperature, StringFormat='{}{0:0}°'}"
                                                                   FontSize="11"
                                                                   Foreground="{DynamicResource TextSecondaryBrush}"/>
                                                        <TextBlock Text=" | " FontSize="11"
                                                                   Foreground="{DynamicResource TextMutedBrush}"/>
                                                        <TextBlock Text="{Binding IconCode, Converter={StaticResource WeatherIconConverter}}"
                                                                   FontSize="11"/>
                                                    </StackPanel>
                                                </StackPanel>
                                                <!-- 활성 도트 -->
                                                <Ellipse x:Name="activeDot" Grid.Column="2"
                                                         Width="6" Height="6" Visibility="Collapsed"
                                                         VerticalAlignment="Center">
                                                    <Ellipse.Fill>
                                                        <SolidColorBrush Color="#00E5FF"/>
                                                    </Ellipse.Fill>
                                                    <Ellipse.Effect>
                                                        <DropShadowEffect Color="#00E5FF" BlurRadius="6"
                                                                          ShadowDepth="0" Opacity="0.6"/>
                                                    </Ellipse.Effect>
                                                </Ellipse>
                                            </Grid>
                                        </Button>
                                        <DataTemplate.Triggers>
                                            <DataTrigger Binding="{Binding IsActive}" Value="True">
                                                <Setter TargetName="activeDot" Property="Visibility" Value="Visible"/>
                                            </DataTrigger>
                                        </DataTemplate.Triggers>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </StackPanel>
                    </DockPanel>
                </Border>
            </Grid>
        </Grid>
    </Border>
</Window>
